{"ast":null,"code":"// Use strict mode (https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode)\n\"use strict\"; // Requires\n\nvar Typo = require(\"typo-js\"); // Create function\n\n\nfunction CodeMirrorSpellChecker(options) {\n  // Initialize\n  options = options || {}; // Verify\n\n  if (typeof options.codeMirrorInstance !== \"function\" || typeof options.codeMirrorInstance.defineMode !== \"function\") {\n    console.log(\"CodeMirror Spell Checker: You must provide an instance of CodeMirror via the option `codeMirrorInstance`\");\n    return;\n  } // Because some browsers don't support this functionality yet\n\n\n  if (!String.prototype.includes) {\n    String.prototype.includes = function () {\n      \"use strict\";\n\n      return String.prototype.indexOf.apply(this, arguments) !== -1;\n    };\n  } // Define the new mode\n\n\n  options.codeMirrorInstance.defineMode(\"spell-checker\", function (config) {\n    // Load AFF/DIC data\n    if (!CodeMirrorSpellChecker.aff_loading) {\n      CodeMirrorSpellChecker.aff_loading = true;\n      var xhr_aff = new XMLHttpRequest();\n      xhr_aff.open(\"GET\", \"https://cdn.jsdelivr.net/codemirror.spell-checker/latest/en_US.aff\", true);\n\n      xhr_aff.onload = function () {\n        if (xhr_aff.readyState === 4 && xhr_aff.status === 200) {\n          CodeMirrorSpellChecker.aff_data = xhr_aff.responseText;\n          CodeMirrorSpellChecker.num_loaded++;\n\n          if (CodeMirrorSpellChecker.num_loaded == 2) {\n            CodeMirrorSpellChecker.typo = new Typo(\"en_US\", CodeMirrorSpellChecker.aff_data, CodeMirrorSpellChecker.dic_data, {\n              platform: \"any\"\n            });\n          }\n        }\n      };\n\n      xhr_aff.send(null);\n    }\n\n    if (!CodeMirrorSpellChecker.dic_loading) {\n      CodeMirrorSpellChecker.dic_loading = true;\n      var xhr_dic = new XMLHttpRequest();\n      xhr_dic.open(\"GET\", \"https://cdn.jsdelivr.net/codemirror.spell-checker/latest/en_US.dic\", true);\n\n      xhr_dic.onload = function () {\n        if (xhr_dic.readyState === 4 && xhr_dic.status === 200) {\n          CodeMirrorSpellChecker.dic_data = xhr_dic.responseText;\n          CodeMirrorSpellChecker.num_loaded++;\n\n          if (CodeMirrorSpellChecker.num_loaded == 2) {\n            CodeMirrorSpellChecker.typo = new Typo(\"en_US\", CodeMirrorSpellChecker.aff_data, CodeMirrorSpellChecker.dic_data, {\n              platform: \"any\"\n            });\n          }\n        }\n      };\n\n      xhr_dic.send(null);\n    } // Define what separates a word\n\n\n    var rx_word = \"!\\\"#$%&()*+,-./:;<=>?@[\\\\]^_`{|}~ \"; // Create the overlay and such\n\n    var overlay = {\n      token: function token(stream) {\n        var ch = stream.peek();\n        var word = \"\";\n\n        if (rx_word.includes(ch)) {\n          stream.next();\n          return null;\n        }\n\n        while ((ch = stream.peek()) != null && !rx_word.includes(ch)) {\n          word += ch;\n          stream.next();\n        }\n\n        if (CodeMirrorSpellChecker.typo && !CodeMirrorSpellChecker.typo.check(word)) return \"spell-error\"; // CSS class: cm-spell-error\n\n        return null;\n      }\n    };\n    var mode = options.codeMirrorInstance.getMode(config, config.backdrop || \"text/plain\");\n    return options.codeMirrorInstance.overlayMode(mode, overlay, true);\n  });\n} // Initialize data globally to reduce memory consumption\n\n\nCodeMirrorSpellChecker.num_loaded = 0;\nCodeMirrorSpellChecker.aff_loading = false;\nCodeMirrorSpellChecker.dic_loading = false;\nCodeMirrorSpellChecker.aff_data = \"\";\nCodeMirrorSpellChecker.dic_data = \"\";\nCodeMirrorSpellChecker.typo; // Export\n\nmodule.exports = CodeMirrorSpellChecker;","map":null,"metadata":{},"sourceType":"module"}